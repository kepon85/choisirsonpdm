<html>
<head>
    <title>Ponts Thermiques</title>
    <meta charset="utf-8">
    <link href="../assets/css/bootstrap.css" rel="stylesheet">
    <link href="../assets/css/bootstrap-print.min.css" media="print"  rel="stylesheet" >
    <link href="../assets/css/jquery-ui.min.css" rel="stylesheet">    
    <link href="../assets/css/select2.min.css" rel="stylesheet">    
    <link href="../assets/css/app.css" rel="stylesheet">
    <script type="text/javascript" src="../assets/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="../assets/js/jquery-3.7.0.min.js"></script>
    <script type="text/javascript" src="../assets/js/select2.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; }
        .container { display: flex; flex-direction: column; align-items: center; }
        .selectors { margin-bottom: 20px; }
        .label { font-size: 14px; font-weight: bold; }
        .arrow { fill: none; stroke: orange; stroke-width: 2; }
        .svg-container {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .svg-element {
      max-width: 100%;
      height: auto;
    }
    </style>
</head>
<body>
    <div class="container">
        <div class="row">
            <p>Ce mur accueil-il un plancher/dalle ou un mur de refend ? Si oui il est susceptible de provoquer un pont thermique</p>
            <p>Les ponts thermiques sont négligées au niveau des liaisons avec des parois en structure bois.</p>
        </div>
        <div class="row">
            <div class="col-sm">    
                <label for="typeBridge">Type de pont thermique : :</label>
                <select class="form-select form-control" id="typeBridge">
                    <option value="">Aucun</option>
                    <option value="floor_lower_wall">Plancher bas / mur</option>
                    <option value="floor_inter_wall">Plancher intermédiaire lourd / mur</option>
                    <option value="floor_high_wall">Plancher haut lourd / mur</option>
                    <option value="partition_wall">Refend / mur</option>
                </select>
            </div>
            <div class="col-sm form_hide form_floor_lower_wall form_floor_inter_wall form_floor_high_wall form_partition_wall">
                <label for="lBridge" class="form_hide form_floor_lower_wall form_floor_high_wall form_floor_inter_wall">Longueur de contact entre le plancher le mur : </label>
                <label for="lBridge" class="form_hide form_partition_wall">Longueur du contact entre le mur de refend le mur extérieur : </label>
                <div class="input-group has-validation">
                    <input type="number" class="form-control" min="0" max="999" step="0.1" id="lBridge" placeholder="Ex: 12.5">
                    <span class="input-group-text">m</span>
                </div>
                <div class="form-text form_hide form_partition_wall">Souvent la longueur du mur</div>
                <div class="form-text form_hide form_floor_lower_wall form_floor_high_wall form_floor_inter_wall">Souvent la hauteur du mur</div>
            </div>
            
        </div>
        <div class="row form_hide form_floor_lower_wall form_floor_inter_wall form_floor_high_wall form_partition_wall">
            <div class="col-sm">
                <label for="wallTypeInsulation">Méthode d'isolation du mur : :</label>
                <select class="form-select form-control typeInsulation"  id="wallTypeInsulation">
                    <option value="no">Non Isolé</option>
                    <option value="ITI">ITI : Isolation par l'intérieur</option>
                    <option value="ITE">ITE : Isolation par l'extérieur</option>
                    <option value="ITR">ITR : Isolation répartie (la structure est isolante)</option>
                    <option value="ITI+ITE">ITI+ITE</option>
                    <option value="ITI+ITR">ITI+ITR</option>
                    <option value="ITE+ITR">ITE+ITR</option>
                </select>
            </div>
            <div class="col-sm form_hide form_floor_lower_wall form_floor_high_wall">
                <label for="floorTypeInsulation">Méthode d'isolation du plancher : :</label>
                <select class="form-select form-control typeInsulation"  id="floorTypeInsulation" class="form_hide form_floor_lower_wall form_floor_high_wall">
                    <option value="no">Non Isolé</option>
                    <option value="ITI">ITI : Isolation par l'intérieur</option>
                    <option value="ITE">ITE : Isolation par l'extérieur</option>
                    <option value="ITI+ITE">ITI+ITE</option>
                </select>
            </div>
        </div>
        <div class="row form_hide form_floor_lower_wall form_floor_inter_wall form_floor_high_wall form_partition_wall">
            <div class="col-sm">
                <svg width="200" height="230">
                    <defs>
                        <pattern id="hachures" x="0" y="0" width="10" height="10" patternUnits="userSpaceOnUse">
                            <line x1="0" y1="10" x2="10" y2="0" stroke="#dc3545" stroke-width="2" stroke-opacity="0.5" />
                        </pattern>
                        <style>
                            .arrow { stroke: #fd7e14; stroke-width: 3; stroke-dasharray: 5,5; }
                            .wall { fill: #6c757d; stroke: #343a40; stroke-width: 2; }
                            .insulation { fill: url(#hachures); opacity: 0.6; }
                            text { font-family: Arial, sans-serif; font-size: 12px; fill: #212529; }
                        </style>
                    </defs>

                    <!-- Labels for inside and outside -->
                    <text x="50" y="20" transform="rotate(-90,100,100)">Extérieur</text>
                    <text class="type_floor_inter_wall type_floor_lower_wall" x="100" y="170" transform="rotate(-90,100,100)">Intérieur</text>
                    <text class="type_floor_inter_wall type_floor_high_wall" x="10" y="170" transform="rotate(-90,100,100)">Intérieur</text> 
                    <defs>
                        <pattern id="hachures" x="0" y="0" width="10" height="10" patternUnits="userSpaceOnUse">
                            <line x1="0" y1="10" x2="10" y2="0" stroke="red" stroke-width="2" stroke-opacity="0.5" />
                        </pattern>
                    </defs>
                    <defs>
                        <pattern id="concrete" patternUnits="userSpaceOnUse" width="10" height="10">
                            <rect width="10" height="10" fill="gray"/>
                            <path d="M 0 0 L 10 10" stroke="darkgray" stroke-width="0.5"/>
                            <path d="M 10 0 L 0 10" stroke="darkgray" stroke-width="0.5"/>
                        </pattern>
                    </defs>
                    <!-- Mur principal -->
                    <rect x="80" y="30" width="40" height="160" fill="url(#concrete)" stroke="black" stroke-width="1" />
                    <!-- Mur principal isolant -->
                    <rect class="walltype_itr" x="80" y="30" width="40" height="160" fill="url(#hachures)" stroke="none" stroke-width="0" />
                    <rect class="walltype_iti" x="118" y="30" width="4" height="160" fill="red" visibility="hidden"/>
                    <rect class="walltype_ite" x="78" y="30" width="4" height="160" fill="red" visibility="hidden"/>
                    <!-- Mur principal text -->
                    <text class="type_floor_inter_wall type_floor_lower_wall" x="120" y="107" transform="rotate(-90,100,100)">Mur</text>
                    <text class="type_floor_high_wall" x="50" y="107" transform="rotate(-90,100,100)">Mur</text>

                    <!-- Plancher inter / mur refend -->
                    <rect class="type_floor_inter_wall type_partition_wall " x="95" y="105" width="100" height="30" fill="url(#concrete)" stroke="black" stroke-width="1"/>
                    <!-- Flèche de transfert thermique -->
                    <path class="type_floor_inter_wall type_partition_wall arrow" d="M 140 90 Q 100 150 50 80" />
                    <line class="type_floor_inter_wall type_partition_wall arrow" x1="50" y1="80" x2="70" y2="90" stroke="black" stroke-width="2"/>
                    <line class="type_floor_inter_wall type_partition_wall arrow" x1="50" y1="80" x2="55" y2="105" stroke="black" stroke-width="2"/>
                    <path class="type_floor_inter_wall type_partition_wall arrow" d="M 140 145 Q 100 100 50 155" />
                    <line class="type_floor_inter_wall type_partition_wall arrow" x1="50" y1="155" x2="55" y2="125" stroke="black" stroke-width="2"/>
                    <line class="type_floor_inter_wall type_partition_wall arrow" x1="50" y1="155" x2="75" y2="150" stroke="black" stroke-width="2"/>
                    <!-- Légende planché -->
                    <text class="type_floor_inter_wall" x="100" y="125" >Plancher inter.</text>
                    <!-- Légende mur refend -->
                    <text class="type_partition_wall" x="110" y="125" >Mur refend</text>

                    <!-- Plancher bas -->
                    <rect class="type_floor_lower_wall" x="95" y="130" width="100" height="30" fill="url(#concrete)" stroke="black" stroke-width="1"/>
                    <!-- Plancher bas isolent  -->
                    <rect class="floortype__floor_lower_wall__iti" x="120" y="128" width="75" height="4" fill="red" />
                    <rect class="floortype__floor_lower_wall__ite" x="120" y="158" width="75" height="4" fill="red" />
                    <!-- Flèche de transfert thermique -->
                    <path class="type_floor_lower_wall arrow" id="heat-arrow" d="M 140 120 Q 100 180 50 100" />
                    <line class="type_floor_lower_wall arrow" x1="50" y1="100" x2="75" y2="110" stroke="black" stroke-width="2"/>
                    <line class="type_floor_lower_wall arrow" x1="50" y1="100" x2="55" y2="130" stroke="black" stroke-width="2"/>
                    <!-- Légende planché  -->
                    <text class="type_floor_lower_wall" x="100" y="150" >Plancher bas</text>
                 
                    <!-- Plancher haut -->
                    <rect class="type_floor_high_wall" x="95" y="50" width="100" height="30" fill="url(#concrete)" stroke="black" stroke-width="1"/>
                    <!-- Plancher haut isolent  -->
                    <rect class="floortype__floor_high_wall__iti" x="120" y="48" width="75" height="4" fill="red" />
                    <rect class="floortype__floor_high_wall__ite" x="120" y="78" width="75" height="4" fill="red" />
                    <!-- Flèche de transfert thermique -->
                    <path class="type_floor_high_wall arrow" d="M 140 95 Q 100 40 50 95" />
                    <line class="type_floor_high_wall arrow" x1="50" y1="95" x2="55" y2="70" stroke="black" stroke-width="2"/>
                    <line class="type_floor_high_wall arrow" x1="50" y1="95" x2="75" y2="90" stroke="black" stroke-width="2"/>
                    <!-- Légende planché  -->
                    <text class="type_floor_high_wall" x="100" y="70" >Plancher haut</text>
                    <rect id="iti-plancher" x="120" y="127" width="75" height="3" fill="red" visibility="hidden"/>
                    <rect id="ite-plancher" x="120" y="160" width="75" height="3" fill="red" visibility="hidden"/>
                    <text class="type_floor_inter_wall type_floor_lower_wall type_floor_high_wall" x="50" y="210">Vue en coupe</text>
                    <text class="type_partition_wall" x="50" y="210">Vue du dessus</text>
                </svg>
            </div>
        </div>
        <div class="row">
            <div class="col-sm">
                <label for="k">Valeur k :</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="k" readonly="readonly">
                    <span class="input-group-text">W/m.K</span>
                </div>
            </div>
            <div class="col-sm">
                <label for="pt">Perte thermique :</label>
                <div class="input-group">
                    <input type="number" class="form-control" id="pt" placeholder="Calculé automatiquement" readonly="readonly">
                    <span class="input-group-text">W/K</span>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript" src="../settings.js"></script>
    <script type="text/javascript" src="../assets/js/default-settings.js"></script>
    <script>
function debug(msg) {
    if (settings.debug) {
        console.log(msg);
    }
}
    // Dialog / popup pont  thermique
    $("#typeBridge").on( "change", function() {
        bridgeFormChamge();
        bridgeUpdateSvg();
    });
    $(".typeInsulation").on( "change", function() {
        bridgeUpdateSvg();
    });
    $("#lBridge").on( "change", function() {
        bridgeCalc();
    });
    

        function bridgeFormChamge() {
            let typeBridge = $("#typeBridge").val();
            if (typeBridge != '') {
                $(".form_hide").hide();
                $(".form_"+typeBridge).show();
            }else{
                $(".form_hide").hide();
            }
            bridgeCalc();
        }
        function bridgeUpdateSvg() {
            debug("Update SVG")
            // Cacher les éléments
            $("[class^='type'], [class^='walltype'], [class^='floortype']").attr("visibility", "hidden");
            
            let typeBridge = $("#typeBridge").val();
            debug(typeBridge);
            // Afficher les éléments du type en cours
            $(".type_"+typeBridge).attr("visibility", "visible");
            
            let wallTypeInsulation = $("#wallTypeInsulation").val();
            if (wallTypeInsulation.includes("ITI")) {
                $(".walltype_iti").attr("visibility", "visible");
            }
            if (wallTypeInsulation.includes("ITE")) {
                $(".walltype_ite").attr("visibility", "visible");
            }
            if (wallTypeInsulation.includes("ITR")) {
                $(".walltype_itr").attr("visibility", "visible");
            }

            let floorTypeInsulation = $("#floorTypeInsulation").val();
            if (floorTypeInsulation.includes("ITI")) {
                $(".floortype__"+typeBridge+"__iti").attr("visibility", "visible");
            }
            if (floorTypeInsulation.includes("ITE")) {
                $(".floortype__"+typeBridge+"__ite").attr("visibility", "visible");
            }
            bridgeCalc();
        }
        function bridgeCalc() {
            debug('bridgeCalc');
            let typeBridge = $("#typeBridge").val();
            let wallTypeInsulation = $("#wallTypeInsulation").val();
            let floorTypeInsulation = $("#floorTypeInsulation").val();
            debug('Type bridge : '+typeBridge);
            let k = "";
            if (typeBridge == "floor_inter_wall") {
                k = settings.pontThermique.floor_inter_wall[wallTypeInsulation] !== undefined ? settings.pontThermique.floor_inter_wall[wallTypeInsulation] : "-";
            } else if (typeBridge == "floor_lower_wall") {
                k = settings.pontThermique.floor_lower_wall[wallTypeInsulation] && settings.pontThermique.floor_lower_wall[wallTypeInsulation][floorTypeInsulation] ? settings.pontThermique.floor_lower_wall[wallTypeInsulation][floorTypeInsulation] : "-";
            } else if (typeBridge == "floor_high_wall") {
                k = settings.pontThermique.floor_high_wall[wallTypeInsulation] && settings.pontThermique.floor_high_wall[wallTypeInsulation][floorTypeInsulation] ? settings.pontThermique.floor_high_wall[wallTypeInsulation][floorTypeInsulation] : "-";
            } else if (typeBridge == "partition_wall") {
                k = settings.pontThermique.partition_wall[wallTypeInsulation] !== undefined ? settings.pontThermique.partition_wall[wallTypeInsulation] : "-";
            } 
            $("#k").val(k);
            // Calcul PT
            lBridge = $("#lBridge").val();
            if ((k != '' || k != '-') && (lBridge != '' || lBridge != '0')) {
                let pt = lBridge * k * 0.5;
                debug("PT: "+pt);
                $("#pt").val(pt.toFixed(1));
            } else {
                $("#pt").val(0);
            }
        }
        
        //$("#mur").change(updateIsolation);
        $( document ).ready(function() {
            bridgeFormChamge();
            bridgeUpdateSvg();
        });

    </script>
</body>
</html>
