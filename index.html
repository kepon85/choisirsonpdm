<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head><script src="./assets/js/color-modes.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="David Mercereau">
    <title>Choose stove mass</title>
    <link href="./assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="./assets/css/app.css" rel="stylesheet">    
    <!-- Load mapbox -->
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
    <!-- Load the `mapbox-gl-geocoder` plugin. -->
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">
  </head>
  <body class="bg-body-tertiary">
    
    <div class="container">
      <main>
        <div class="py-5 text-center">
          <img class="d-block mx-auto mb-4" src="./assets/img/choose-mass-stove.svg" alt="" width="177" height="87">
          <h2>Choose your mass stove</h2>
          <p class="lead">Application qui vise Ã  vous aider Ã  choisir le bon poÃªle de masse pour votre habitat.</p>
        </div>

        <div class="row g-4">
          <div class="col-md-6">
            <h4 class="mb-3">Geographical location</h4>
            <form>
              <div class="row g-3 card p-2">
                <div class="input-group">
                  <label for="lat" class="form-label">Latitude : </label>
                  <input type="number" class="form-control hashchange" min="-180" max="180" step="0.000001" name="lat" id="lat" value="">
                  <label for="lon" class="form-label">Longitude : </label>
                  <input type="number" class="form-control hashchange"  min="-180" max="180" step="0.000001" name="lon" id="lon" value="">
                </div>
              </div>
            </form>
          </div>
          <div class="col-md-6">
            <div class="row g-3">
              <div class="col-12">
                <label for="level" class="form-label">Your degree of knowledge in mass stove : </label>
                <select id="level" name="level">
                  <option value="1">Beginner</option>
                  <option value="2" selected="selected">Enlightened</option>
                  <option value="3">Expert</option>
                </select>
              </div>
            </div>
            <h4 class="mb-3">The volume to be heated</h4>
            <form class="needs-validation" novalidate>
              <div class="row g-3">
                <!-- Surface habitable -->
                <div class="col-12">
                  <label for="livingspace" class="form-label">Living space</label>
                  <div class="input-group has-validation">
                    <input type="text" class="form-control" id="livingspace" placeholder="Living space" required>
                    <span class="input-group-text">m<sup>2</sup></span>
                    <div class="invalid-feedback">
                      Living space required
                    </div>
                  </div>
                </div>

                <!-- Coefficient de dÃ©perditions G -->
                
                <div id="map" style="width: 100%; height: 300px;"></div>
                <script>
                  // Change de comportement si marker prÃ©sent par dÃ©faut
                  var justClick = true;
                  // Set Longitude/latitude 
                  function setLocalLngLat(lng, lat){
                    lat = precise_round(lat, 6);
                    lng = precise_round(lng, 6);
                    var newData = {'lng': lng, 'lat': lat};
                    $( "#lon" ).val( lng );
                    $( "#lat" ).val( lat );	
                    localStorage.setItem('lngLat', JSON.stringify(newData));
                  }
                  mapboxgl.accessToken = 'pk.eyJ1Ijoia2Vwb24tcGRtIiwiYSI6ImNsam91MzF4ejAyYXMzZHA3YzJocnZjemIifQ.Lx-TCB9dD9R_3EhNH7Wf_Q';
                  // Position de la carte par dÃ©faut
                  if (localStorage.getItem('lngLat')) {
                    var storageLngLat = JSON.parse(localStorage.getItem('lngLat'));
                    var lng = storageLngLat.lng;
                    var lat = storageLngLat.lat;
                    var zoom = 8;
                  } else {
                    var lng = 3;
                    var lat =47;
                    var zoom = 4;
                  }
                  // Init de la cart
                  var map = new mapboxgl.Map({
                    container: 'map', // container id
                    style: 'mapbox://styles/mapbox/streets-v11',
                    center: [lng, lat], // starting position
                    zoom: zoom // starting zoom
                  });
                  // Init recherche par geocoder
                  const geocoder = new MapboxGeocoder({
                    mapboxgl: mapboxgl,                                                                               
                    accessToken: mapboxgl.accessToken,
                    marker: false
                  })
                  // Quand un rÃ©sultat est trouvÃ©
                  geocoder.on('result', e => {
                    // On arrÃªte de toucher au click
                    justClick = false;
                    // On ajoute la navigation 
                    map.addControl(new mapboxgl.NavigationControl());
                    // On enregistre la position de la recherche
                    setLocalLngLat(e.result.center[0], e.result.center[1], 6);
                    // On ajoute un marker draggable sur le point de la recherche
                    const marker = new mapboxgl.Marker({
                      draggable: true
                    }).setLngLat(e.result.center).addTo(map)
                    // A chaque fois que le marker est dÃ©placer
                    marker.on('dragend', e => {
                      // on enregistre sa position
                      setLocalLngLat(e.target._lngLat.lng, e.target._lngLat.lat);
                    })
                  })
                  map.addControl(geocoder)
                  // Si j'ai une position d'enregistrÃ© dans localStorage
                  if (localStorage.getItem('lngLat')) {
                    var storageLngLat = JSON.parse(localStorage.getItem('lngLat'));
                    // Je crÃ©e un maker sur cette position
                    const markerClick = new mapboxgl.Marker()
                      .setLngLat([storageLngLat.lng, storageLngLat.lat])
                      .addTo(map);
                    // On ajoute la navigation 
                    map.addControl(new mapboxgl.NavigationControl());
                    // Si on click sur la carte, on enregistre la position du nouveau marqueur
                    function add_marker (event) {
                      if (justClick == true) {
                        var coordinates = event.lngLat;
                        setLocalLngLat(coordinates.lng, coordinates.lat);
                        markerClick.setLngLat(coordinates).addTo(map);
                      }
                    }
                    map.on('click', add_marker);
                  }
                </script>

              <button class="w-100 btn btn-primary btn-lg" type="submit">Continue to checkout</button>
            </form>
          </div>
        </div>

        <hr class="my-4">

        <div class="row g-4">
          <div class="col-md-6">
            <h4 class="mb-3">Result</h4>
          </div>

        </div>

      </main>



      <footer class="my-5 pt-5 text-body-secondary text-center text-small">
        <p class="mb-1">ðŸ„¯ CopyLeft David Mercereau</p>
        <ul class="list-inline">
          <li class="list-inline-item"><a href="#">Privacy</a></li>
          <li class="list-inline-item"><a href="#">Terms</a></li>
          <li class="list-inline-item"><a href="#">Support</a></li>
        </ul>
      </footer>
    </div>

<!-- Parametres -->
<script src="./settings.js"></script>
<script src="./assets/js/default-settings.js"></script>
<script src="./assets/js/bootstrap.bundle.min.js"></script>
<script src="./assets/js/jquery-3.7.0.min.js"></script>
<script src="./assets/js/app.js"></script>

</html>
