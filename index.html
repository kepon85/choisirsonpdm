<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head><script src="./assets/js/color-modes.js"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="David Mercereau">
    <title>Choose stove mass</title>
    <link href="./assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="./assets/css/app.css" rel="stylesheet">    
  </head>
  <body class="bg-body-tertiary">
    
    <div class="container">
      <main>
        <div class="py-5 text-center">
          <img class="d-block mx-auto mb-4" src="./assets/img/choose-mass-stove.svg" alt="" width="177" height="87">
          <h2>Choose your mass stove</h2>
          <p class="lead">Application qui vise Ã  vous aider Ã  choisir le bon poÃªle de masse pour votre habitat.</p>
        </div>

        <div class="row g-4">
          <div class="col-md-6">
            <h4 class="mb-3">Geographical location</h4>
            <form>
              <div class="row g-3 card p-2">
                <div class="input-group">
                  <label for="lat" class="form-label">Latitude : </label>
                  <input type="number" class="form-control hashchange" min="-180" max="180" step="0.000001" name="lat" id="lat" value="">
                  <label for="lon" class="form-label">Longitude : </label>
                  <input type="number" class="form-control hashchange"  min="-180" max="180" step="0.000001" name="lon" id="lon" value="">
                </div>
              </div>
            </form>
          </div>
          <div class="col-md-6">
            <div class="row g-3">
              <div class="col-12">
                <label for="level" class="form-label">Your degree of knowledge in mass stove : </label>
                <select id="level" name="level">
                  <option value="1">Beginner</option>
                  <option value="2" selected="selected">Enlightened</option>
                  <option value="3">Expert</option>
                </select>
              </div>
            </div>
            <h4 class="mb-3">The volume to be heated</h4>
            <form class="needs-validation" novalidate>
              <div class="row g-3">
                <!-- Surface habitable -->
                <div class="col-12">
                  <label for="livingspace" class="form-label">Living space</label>
                  <div class="input-group has-validation">
                    <input type="text" class="form-control" id="livingspace" placeholder="Living space" required>
                    <span class="input-group-text">m<sup>2</sup></span>
                    <div class="invalid-feedback">
                      Living space required
                    </div>
                  </div>
                </div>

                <!-- Coefficient de dÃ©perditions G -->
             
                <div id="mapid" style="width: 100%; height: 300px;"></div>
                <script>
                  // CrÃ©ation de la carte
                  <?php 
                  // Exception pour la france on ce met sur la France (le public principal)
                  $mapZoom=$config_ini['formulaire']['zoomDefaut'];
                  if ($country == 'FR') {
                    $config_ini['formulaire']['lat'] = 47;
                    $config_ini['formulaire']['lon'] = 3;
                    $mapZoom=5;
                  }
                  if (isset($_GET['lat']) || isset($_COOKIE['lat'])) {
                    $mapZoom=$config_ini['formulaire']['zoom'];
                  }
                  
                  ?>
                  var mymap = L.map('mapid').setView([<?php valeurRecupCookie('lat') ?>, <?php valeurRecupCookie('lon') ?>], <?= $mapZoom ?>);
                  
                  L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoia2Vwb24tcGRtIiwiYSI6ImNsam91MzF4ejAyYXMzZHA3YzJocnZjemIifQ.Lx-TCB9dD9R_3EhNH7Wf_Q', {
                    maxZoom: 18,
                    id: 'mapbox/streets-v11',
                    tileSize: 512,
                    zoomOffset: -1,
                    accessToken: 'pk.eyJ1Ijoia2Vwb24tcGRtIiwiYSI6ImNsam91MzF4ejAyYXMzZHA3YzJocnZjemIifQ.Lx-TCB9dD9R_3EhNH7Wf_Q'
                  }).addTo(mymap);
                    
                  var popup = L.popup();
        
                  <?php 
                  if (isset($_GET['lat'])) {
                    echo "var Marker = L.marker([".$_GET['lat'].", ".$_GET['lon']."]);\n";
                    echo "Marker.addTo(mymap);\n";
                  } else if (isset($_COOKIE['lat'])) {
                    echo "var Marker = L.marker([".$_COOKIE['lat'].", ".$_COOKIE['lon']."]);\n";
                    echo "Marker.addTo(mymap);\n";
                  }
                  ?>
                  
                  function onMapClick(e) {
                    popup
                      .setLatLng(e.latlng)
                      .setContent("<?= _('Selected position') ?> : " + e.latlng.toString())
                      .openOn(mymap);
                  
                    var split1 = e.latlng.toString().split("(")
                    var split2 = split1[1].split(")")
                    var split3 = split2[0].split(", ")
                    var lat = split3[0];
                    var lon = split3[1];
                    $( "#lat" ).val(lat);	
                    $( "#lon" ).val(lon);
                    sumbitEnable();	 
                    <?php 
                    if (isset($_GET['lat']) || isset($_COOKIE['lat'])) {
                      echo "Marker.remove(mymap);\n";
                    }
                    ?>
                  }
                  
                  mymap.on('click', onMapClick);
                </script>

              <button class="w-100 btn btn-primary btn-lg" type="submit">Continue to checkout</button>
            </form>
          </div>
        </div>

        <hr class="my-4">

        <div class="row g-4">
          <div class="col-md-6">
            <h4 class="mb-3">Result</h4>
          </div>

        </div>

      </main>



      <footer class="my-5 pt-5 text-body-secondary text-center text-small">
        <p class="mb-1">ðŸ„¯ CopyLeft David Mercereau</p>
        <ul class="list-inline">
          <li class="list-inline-item"><a href="#">Privacy</a></li>
          <li class="list-inline-item"><a href="#">Terms</a></li>
          <li class="list-inline-item"><a href="#">Support</a></li>
        </ul>
      </footer>
    </div>


<!-- Parametres -->
<script src="./settings.js"></script>
<script src="./assets/js/default-settings.js"></script>
<script src="./assets/js/bootstrap.bundle.min.js"></script>
<script src="./assets/js/jquery-3.7.0.min.js"></script>
<script src="./assets/js/app.js"></script>

</html>
